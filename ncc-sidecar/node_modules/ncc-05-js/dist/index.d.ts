/**
 * NCC-05: Identity-Bound Service Locator Resolution
 *
 * This library implements the NCC-05 convention for publishing and resolving
 * dynamic service endpoints (IP, Port, Onion) bound to Nostr identities.
 *
 * @module ncc-05-js
 */
import { SimplePool, Event } from 'nostr-tools';
export declare const TAG_PRIVATE = "private";
export declare function isPrivateLocator(event: Event): boolean;
export declare class NCC05Error extends Error {
    constructor(message: string);
}
export declare class NCC05RelayError extends NCC05Error {
    constructor(message: string);
}
export declare class NCC05TimeoutError extends NCC05Error {
    constructor(message: string);
}
export declare class NCC05DecryptionError extends NCC05Error {
    constructor(message: string);
}
export declare class NCC05ArgumentError extends NCC05Error {
    constructor(message: string);
}
/**
 * Represents a single reachable service endpoint.
 */
export interface NCC05Endpoint {
    /** Protocol type, e.g., 'tcp', 'udp', 'http' */
    type: 'tcp' | 'udp' | string;
    /** The full endpoint URL, e.g., 'tcp://1.2.3.4:8080' or 'http://[2001:db8::1]:9000' */
    url: string;
    /** Priority for selection (lower is higher priority, default: 1000) */
    priority?: number;
    /** Network family for routing hints: 'onion', 'ipv6', 'ipv4' */
    family?: 'ipv4' | 'ipv6' | 'onion' | string;
    /** Transport key fingerprint for TLS/Noise protected endpoints */
    k?: string;
}
/**
 * Deterministically sorts endpoints according to NCC-05 normative rules.
 * 1. Priority (ascending)
 * 2. Family (onion < ipv6 < ipv4)
 * 3. Original order
 */
export declare function selectEndpoints(endpoints: NCC05Endpoint[]): NCC05Endpoint[];
/**
 * The logical structure of an NCC-05 locator record payload.
 */
export interface NCC05Payload {
    /** Payload version (currently 1) */
    v: number;
    /** Time-to-live in seconds */
    ttl: number;
    /** Unix timestamp of the last update */
    updated_at: number;
    /** List of available endpoints */
    endpoints: NCC05Endpoint[];
    /** Optional capability identifiers supported by the service */
    caps?: string[];
    /** Optional human-readable notes */
    notes?: string;
}
/**
 * Options for configuring the NCC05Resolver.
 */
export interface ResolverOptions {
    /** List of relays used to bootstrap discovery */
    bootstrapRelays?: string[];
    /** Timeout for relay queries in milliseconds (default: 10000) */
    timeout?: number;
    /** Existing SimplePool instance to share connections */
    pool?: SimplePool;
}
/**
 * Options for configuring the NCC05Publisher.
 */
export interface PublisherOptions {
    /** Existing SimplePool instance */
    pool?: SimplePool;
    /** Timeout for publishing in milliseconds (default: 5000) */
    timeout?: number;
}
/**
 * Structure for multi-recipient encrypted events.
 * Implements a "wrapping" pattern to share one event with multiple keys.
 */
export interface WrappedContent {
    /** The NCC05Payload encrypted with a random symmetric session key */
    ciphertext: string;
    /** Map of recipient pubkey (hex) to the encrypted session key */
    wraps: Record<string, string>;
}
/**
 * Utility for managing shared group access to service records.
 */
export declare class NCC05Group {
    /**
     * Generates a fresh identity (keypair) for a shared group.
     * The resulting nsec should be shared with all authorized group members.
     *
     * @returns An object containing nsec, hex pubkey, and the raw secret key.
     */
    static createGroupIdentity(): {
        nsec: `nsec1${string}`;
        sk: Uint8Array<ArrayBufferLike>;
        pk: string;
        npub: `npub1${string}`;
    };
    /**
     * Helper to resolve a record using a group's shared identity.
     *
     * @param resolver - An initialized NCC05Resolver instance.
     * @param groupPubkey - The public key of the group.
     * @param groupSecretKey - The shared secret key of the group.
     * @param identifier - The 'd' tag of the record (default: 'addr').
     * @returns The resolved NCC05Payload or null.
     */
    static resolveAsGroup(resolver: NCC05Resolver, groupPubkey: string, groupSecretKey: string | Uint8Array, identifier?: string): Promise<NCC05Payload | null>;
}
/**
 * Handles the discovery, selection, and decryption of NCC-05 locator records.
 */
export declare class NCC05Resolver {
    private pool;
    private _ownPool;
    private bootstrapRelays;
    private timeout;
    /**
     * @param options - Configuration for the resolver.
     */
    constructor(options?: ResolverOptions);
    /**
     * Resolves a locator record for a given identity.
     *
     * Supports standard NIP-44 encryption, multi-recipient "wrapping",
     * and plaintext public records.
     *
     * @param targetPubkey - The pubkey (hex or npub) of the service owner.
     * @param secretKey - Your secret key (required if the record is encrypted).
     * @param identifier - The 'd' tag of the record (default: 'addr').
     * @param options - Resolution options (strict mode, gossip discovery).
     * @returns The resolved and validated NCC05Payload, or null if not found.
     * @throws {NCC05TimeoutError} if resolution times out.
     * @throws {NCC05RelayError} if underlying relay communication fails.
     */
    resolve(targetPubkey: string, secretKey?: string | Uint8Array, identifier?: string, options?: {
        strict?: boolean;
        gossip?: boolean;
    }): Promise<NCC05Payload | null>;
    /**
     * Closes connections to all relays in the pool if managed internally.
     */
    close(): void;
}
/**
 * Handles the construction, encryption, and publication of NCC-05 events.
 */
export declare class NCC05Publisher {
    private pool;
    private _ownPool;
    private timeout;
    /**
     * @param options - Configuration for the publisher.
     */
    constructor(options?: PublisherOptions);
    private _publishToRelays;
    /**
     * Publishes a single record encrypted for multiple recipients using the wrapping pattern.
     * This avoids sharing a single group private key.
     *
     * @param relays - List of relays to publish to.
     * @param secretKey - The publisher's secret key.
     * @param recipients - List of recipient public keys (hex).
     * @param payload - The service locator payload.
     * @param identifier - The 'd' tag identifier (default: 'addr').
     * @returns The signed Nostr event.
     */
    publishWrapped(relays: string[], secretKey: string | Uint8Array, recipients: string[], payload: NCC05Payload, optionsOrIdentifier?: {
        identifier?: string;
        privateLocator?: boolean;
    } | string): Promise<Event>;
    /**
     * Publishes a locator record. Supports self-encryption, targeted encryption, or plaintext.
     *
     * @param relays - List of relays to publish to.
     * @param secretKey - The publisher's secret key.
     * @param payload - The service locator payload.
     * @param options - Publishing options (identifier, recipient, or public flag).
     * @returns The signed Nostr event.
     */
    publish(relays: string[], secretKey: string | Uint8Array, payload: NCC05Payload, options?: {
        identifier?: string;
        recipientPubkey?: string;
        public?: boolean;
        privateLocator?: boolean;
    }): Promise<Event>;
    /**
     * Closes connections to the specified relays if managed internally.
     */
    close(relays: string[]): void;
}
